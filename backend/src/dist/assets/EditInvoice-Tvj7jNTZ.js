import{k as Qe,u as Le,f as Me,R as c,r as z,j as a}from"./index-CGCJRBXs.js";import{j as U,a as P,g as m,p as Ge,B as ve}from"./App-XreTAmzn.js";import{R as be}from"./quill.snow-xofwrqXY.js";import{d as Ye}from"./Add-BLFCugj5.js";import{u as Ke}from"./useCurrency--7UCyqb2.js";import{d as fe}from"./Delete-C414BZuq.js";import{d as Je}from"./Remove-caFhJcaU.js";import{C as q}from"./ColorButton-DU_nmFNW.js";import{T as Xe}from"./Toolbar-m-EyFJSu.js";import{B as H}from"./Box-BfZ9aPM0.js";import{T as Ze}from"./Typography-RCjPBWvE.js";import{G as i}from"./Grid-CN4_8jt6.js";import{T as k}from"./TextField-Bhii07AO.js";import{S as C}from"./Select-hHeL8oeK.js";import{M as h}from"./MenuItem-DT3WvV_t.js";import{C as ea}from"./Checkbox-Dr1lpnPB.js";import{L as aa}from"./ListItemText-CcncvfTV.js";import{s as ta}from"./styled-VyqOG4MM.js";import{B as ra}from"./Button-DmrIAVQi.js";import"./createSvgIcon-DkNK3VsP.js";import"./createSvgIcon-CWJBf_dQ.js";import"./TransitionGroupContext-DCu7Y_zK.js";import"./isMuiElement-C_WCXon2.js";import"./ButtonBase--q0F1ziJ.js";import"./FormControl-y3ZRJ1PJ.js";import"./Menu-nsvb1963.js";import"./Backdrop-CfdoqMb9.js";import"./utils-vkrW-C7n.js";import"./dividerClasses-CL_qDVcm.js";import"./listItemTextClasses-BWrrQlVX.js";import"./SwitchBase-DpfsYpNO.js";const oa=ta(ra)(({theme:j})=>({color:j.palette.getContrastText(Ge[500]),backgroundColor:"red","&:hover":{backgroundColor:"red"}}));function Aa(){const j=Qe(),F=Le(),{currencyList:N}=Ke(),[l]=Me(),[Q,y]=c.useState(0),[L,M]=c.useState(""),[ye,me]=c.useState(""),[G,Y]=c.useState(""),[ke,Ce]=c.useState("yes"),[$,$e]=c.useState([]),[K,v]=c.useState(0),[J,X]=c.useState(""),[Se,we]=c.useState(""),[A,D]=c.useState(0),[V,Te]=c.useState([]),[b,Z]=c.useState(""),[ee,ae]=c.useState("unpaid"),[g,te]=c.useState(""),[re,oe]=c.useState(""),[se,S]=c.useState(0),[w,ne]=c.useState([]),[le,de]=c.useState(""),[ce,ie]=c.useState(""),[Ie,_e]=c.useState(""),[p,R]=c.useState(0),[T,B]=c.useState(!1),[ue,xe]=c.useState("Default"),[I,he]=c.useState(0),[Pe,qe]=c.useState(""),[d,f]=z.useState([{productName:"",productId:"",qty:"",price:"",tax:0,taxValue:0,amount:0}]),_="api";z.useEffect(()=>{var t,r;const e=U(localStorage.getItem("token"));Re((t=e==null?void 0:e.data)==null?void 0:t.id),Fe((r=e==null?void 0:e.data)==null?void 0:r.id),De(),ze()},[]);const pe={toolbar:[[{header:"1"},{header:"2"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},O=(e,t)=>{t=="error"?ve.error(e,{position:"top-center",autoClose:1900,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}):ve.success(e,{position:"top-center",autoClose:1900,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"})},De=async()=>{await P.get(`/${_}/v1/invoice/${j==null?void 0:j.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>{var t,r,s,n,o,x;e.data.status=="201"&&(M(e.data.data[0].invoice_number),we((r=(t=e==null?void 0:e.data)==null?void 0:t.data[0])==null?void 0:r.url),me((n=(s=e==null?void 0:e.data)==null?void 0:s.data[0])==null?void 0:n.userid),qe((x=(o=e==null?void 0:e.data)==null?void 0:o.data[0])==null?void 0:x.othersInfo),M(e.data.data[0].invoice_number),oe(e.data.data[0].invoice_date),ie(e.data.data[0].due_date),ae(e.data.data[0].status),xe(e.data.data[0].invoice_country),de(e.data.data[0].payment_qr_code),Z(e.data.data[0].currency),_e(e.data.data[0].recurring_cycle),Ce(e.data.data[0].recurring),D(e.data.data[0].subTotal),S(e.data.data[0].sub_discount),y(e.data.data[0].sub_tax),v(e.data.data[0].total),f(e.data.data[0].productsInfo),te(e.data.data[0].discount_type),R(e.data.data[0].discount),ne(e.data.data[0].tax),Y(e.data.data[0].note),X(e.data.data[0].terms),(e.data.data[0].note||e.data.data[0].terms)&&B(!0))}).catch(e=>{console.log("error",e)})},Re=async e=>{await P.get(`/${_}/v1/tax/list/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(t=>{t.data.status=="201"&&$e(t.data.data)}).catch(t=>{console.log("error",t)})},Fe=async e=>{await P.get(`/${_}/v1/qrcode/list/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(t=>{t.data.status=="201"&&Te(t.data.data)}).catch(t=>{console.log("error",t)})},Ne=()=>{f([...d,{productName:"",productId:"",qty:"",price:"",tax:0,taxValue:0,amount:0}])};z.useEffect(()=>{Ae()},[d,g,p,w]);const Ae=()=>{var e=0,t=0;if(d==null||d.map(u=>{u.qty!=""&&u.price!=""&&(e=e+parseFloat(u.qty)*parseFloat(u.price)),u.tax>0&&(t=t+u.taxValue)}),t>0){var r=e+t;y(t),v(r),D(e)}else y(t),v(e),D(e);if(g!=""){if(g=="fixed"){var s=e*t/100;if(I>0)var r=e+I-p;else var r=e+s-p;y(s),v(r),D(e),S(p)}else if(g=="percentage"){var s=e*t/100;if(I>0){var r=e+I-(e+I)*(p/100);S((e+I)*p/100)}else{var r=e+s-(e+s)*p/100;S((e+s)*p/100)}y(s),v(r),D(e)}}var n=0;if(w.length>0&&($==null||$.map(u=>{w.includes(`${u.Name}-${u.taxvalue}`)&&(n=n+u.taxvalue)})),n>0){var r=e+t,o=r*n/100,x=r+o;he(t+o),y(t+o),v(x),g!=""&&(console.log("newTotal",x,g,p),g=="fixed"&&p>0?(v(x-parseFloat(p)),S(p)):g=="percentage"&&(v(x-x*parseFloat(p)/100),S(x*parseFloat(p)/100)))}else he(t),y(t)};async function Ve(e){const t=e.split("-");return await P.get(`/${_}/v1/product/${t[0]}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(s=>{var n,o,x,u;if(s.data.status==201)return console.log("Price",(o=(n=s==null?void 0:s.data)==null?void 0:n.data)==null?void 0:o.unitPrice),(u=(x=s==null?void 0:s.data)==null?void 0:x.data)==null?void 0:u.unitPrice}).catch(s=>{console.log("Invoice Product API Error",s)})}const W=async(e,t)=>{let{name:r,value:s}=e.target;if(r=="qty"){let n=[...d];n[t].qty=s,f(n),d==null||d.map((o,x)=>{x==t&&o.qty!=""&&o.price!=""&&(n[t].amount=parseFloat(o.qty)*parseFloat(o.price),n[t].taxValue=(o==null?void 0:o.amount)*o.tax/100)})}else if(r=="price"){let n=[...d];n[t].price=s,f(n),d==null||d.map((o,x)=>{x==t&&o.qty!=""&&o.price!=""&&(n[t].amount=parseFloat(o.qty)*parseFloat(o.price),n[t].taxValue=(o==null?void 0:o.amount)*o.tax/100)})}else if(r=="productName"){const n=await Ve(s);let o=[...d];const x=s.split("-");o[t].productName=x[1],o[t].productId=x[0],o[t].price=n,o[t].qty="1",d==null||d.map((u,He)=>{He==t&&u.qty!=""&&u.price!=""&&(o[t].amount=parseFloat(u.qty)*parseFloat(u.price),o[t].taxValue=(u==null?void 0:u.amount)*u.tax/100)}),f(o)}else if(r=="amount"){let n=[...d];n[t].amount=s,f(n)}else if(r=="tax"){let n=[...d];console.log("taxvalue",s),n[t].tax=s,f(n),d==null||d.map((o,x)=>{x==t&&o.qty!=""&&o.price!=""&&(n[t].taxValue=(o==null?void 0:o.amount)*o.tax/100)})}},Be=e=>{te(e),R(0)},Oe=e=>{const t=[...d];t.splice(e,1),f(t)},We=e=>{const{target:{value:t}}=e;ne(typeof t=="string"?t.split(","):t)},[E,Ee]=c.useState([]),ze=async()=>{var t;const e=U(localStorage.getItem("token"));await P.get(`/${_}/v1/product/list/${(t=e==null?void 0:e.data)==null?void 0:t.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(r=>{var s,n;((s=r==null?void 0:r.data)==null?void 0:s.status)=="201"&&Ee((n=r==null?void 0:r.data)==null?void 0:n.data)}).catch(r=>{console.log("error",r)})},ge=async e=>{var r;const t=U(localStorage.getItem("token"));await P.patch(`/${_}/v1/invoice/update/${j==null?void 0:j.id}`,{user:(r=t==null?void 0:t.data)==null?void 0:r.id,url:Se,userid:ye,othersInfo:Pe,invoice_number:L,invoice_country:ue,invoice_date:re,due_date:ce,payment_qr_code:le,currency:b,recurring:ke,recurring_cycle:Ie,productsInfo:d,discount:p,discount_type:g,tax:w,subTotal:A,sub_discount:se,sub_tax:Q,total:K,status:ee,note:G,terms:J,noteandterms:T,currency_text:m(b),type:e},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(s=>{s.data.status=="201"&&(O(s.data.message,"success"),F("/invoice-section"))}).catch(s=>{console.log("error",s),O(s.response.data.message,"error")})},Ue=()=>{var e=confirm("Are you sure?");if(e==!0)F("/invoice-section");else return!1},je=e=>{e>A?(O("Discount should be less than or equal to subtotal amount","error"),R(0)):R(e)};return a.jsx(a.Fragment,{children:a.jsx(Xe,{sx:{display:"flex",flexDirection:"column",borderRadius:".5rem",p:"2px",marginTop:"10px",background:{xs:`${l?"#183153":""}`,md:`${l?"#183153":"white"}`},border:{xs:`${l?"1px solid white":""}`,md:`${l?"1px solid white":"white"}`}},children:a.jsxs(H,{sx:{marginTop:"0%",borderRadius:".5rem"},children:[a.jsx(Ze,{children:a.jsx(q,{sx:{cursor:"pointer",float:"right",marginTop:"10px"},onClick:()=>F("/invoice-section"),children:"Back"})}),a.jsxs(i,{container:!0,spacing:3,children:[a.jsxs(i,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Invoice #"}),a.jsx(k,{required:!0,id:"invoice",name:"invoice",value:L,fullWidth:!0,sx:{border:"1px solid silver",borderRadius:"7px"},inputProps:{shrink:!0}})]}),a.jsxs(i,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Invoice Date"}),a.jsx(k,{required:!0,id:"value",name:"value",type:"date",value:re,fullWidth:!0,onChange:e=>oe(e.target.value),sx:{border:"1px solid silver",borderRadius:"7px"},inputProps:{shrink:!0}})]}),a.jsxs(i,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Due Date"}),a.jsx(k,{required:!0,id:"value",name:"value",type:"date",fullWidth:!0,value:ce,onChange:e=>ie(e.target.value),sx:{border:"1px solid silver",borderRadius:"7px"},inputProps:{shrink:!0}})]}),a.jsxs(i,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Status"}),a.jsxs(C,{fullWidth:!0,value:ee,sx:{border:`${l?"1px solid white":""}`},onChange:e=>ae(e.target.value),children:[a.jsx(h,{value:"paid",sx:{color:`${l?"white":"black"}`},children:"Paid"}),a.jsx(h,{value:"unpaid",sx:{color:`${l?"white":"black"}`},children:"Unpaid"}),a.jsx(h,{value:"partial",sx:{color:`${l?"white":"black"}`},children:"Partially Paid"}),a.jsx(h,{value:"overdue",sx:{color:`${l?"white":"black"}`},children:"Overdue"}),a.jsx(h,{value:"processing",sx:{color:`${l?"white":"black"}`},children:"Processing"})]})]}),a.jsxs(i,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Invoice Template:"}),a.jsxs(C,{fullWidth:!0,value:ue,name:"status",sx:{border:"1px solid silver",borderRadius:"7px"},onChange:e=>xe(e.target.value),children:[a.jsx(h,{value:"Default",sx:{color:`${l?"white":"black"}`},children:"Default"}),a.jsx(h,{value:"New_York",sx:{color:`${l?"white":"black"}`},children:"New York"}),a.jsx(h,{value:"Toronto",sx:{color:`${l?"white":"black"}`},children:"Toronto"}),a.jsx(h,{value:"Rio",sx:{color:`${l?"white":"black"}`},children:"Rio"}),a.jsx(h,{value:"London",sx:{color:`${l?"white":"black"}`},children:"London"}),a.jsx(h,{value:"Istanbul",sx:{color:`${l?"white":"black"}`},children:"Istanbul"}),a.jsx(h,{value:"Mumbai",sx:{color:`${l?"white":"black"}`},children:"Mumbai"}),a.jsx(h,{value:"Hong_Kong",sx:{color:`${l?"white":"black"}`},children:"Hong Kong"}),a.jsx(h,{value:"Tokyo",sx:{color:`${l?"white":"black"}`},children:"Tokyo"}),a.jsx(h,{value:"Paris",sx:{color:`${l?"white":"black"}`},children:"Paris"})]})]}),a.jsxs(i,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Payment QR Code:"}),a.jsx(C,{value:le,name:"payment_qr_code",onChange:e=>de(e.target.value),sx:{border:"1px solid silver",borderRadius:"7px"},fullWidth:!0,children:V==null?void 0:V.map((e,t)=>a.jsx(h,{value:e==null?void 0:e._id,sx:{color:`${l?"white":"black"}`},children:e==null?void 0:e.title},t))})]}),a.jsxs(i,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Select Currency:"}),a.jsx(C,{fullWidth:!0,value:b,name:"currency",onChange:e=>Z(e.target.value),sx:{border:"1px solid silver",borderRadius:"7px"},children:N==null?void 0:N.map((e,t)=>a.jsxs(h,{value:e==null?void 0:e.base_code,sx:{color:`${l?"white":"black"}`},children:[m(e==null?void 0:e.base_code)," ",e==null?void 0:e.base_code]},t))})]}),a.jsx(i,{item:!0,xs:12,sm:12,sx:{display:"flex",flexDirection:"row",justifyContent:"end",marginBottom:"12px"},children:a.jsx(q,{onClick:()=>Ne(),children:"Add"})}),a.jsx(H,{sx:{overflow:"auto"},children:a.jsx(H,{sx:{width:"100%",display:"table",tableLayout:"fixed"},children:a.jsx(i,{item:!0,xs:12,sm:12,children:a.jsxs("table",{width:"100%",style:{borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{background:"#c0c0c01f"},children:[a.jsx("th",{style:{padding:"10px"},children:"#"}),a.jsx("th",{style:{padding:"10px"},children:"PRODUCT"}),a.jsx("th",{style:{padding:"10px"},children:"QTY"}),a.jsx("th",{style:{padding:"10px"},children:"UNIT PRICE"}),a.jsx("th",{style:{padding:"10px"},children:"AMOUNT"}),a.jsx("th",{style:{minWidth:"100px"},children:"ACTION"})]})}),a.jsxs("tbody",{children:[d.map((e,t)=>a.jsxs("tr",{children:[a.jsx("td",{align:"center",style:{padding:"10px"},children:t+1}),a.jsx("td",{align:"center",style:{padding:"10px"},children:a.jsx(C,{id:"productName",value:`${e==null?void 0:e.productId}-${e==null?void 0:e.productName}`,name:"productName",onChange:r=>W(r,t),sx:{border:`${l?"1px solid silver":"black"}`,minWidth:"120px"},fullWidth:!0,required:!0,children:E==null?void 0:E.map((r,s)=>a.jsx(h,{value:`${r==null?void 0:r._id}-${r==null?void 0:r.name}`,children:r==null?void 0:r.name},s))})}),a.jsx("td",{align:"center",style:{padding:"10px"},children:a.jsx(k,{required:!0,id:"qty",name:"qty",type:"number",value:e==null?void 0:e.qty,placeholder:"Enter Quantity",fullWidth:!0,sx:{border:"1px solid white",borderRadius:"7px",minWidth:"200px"},onChange:r=>W(r,t),inputProps:{shrink:!0}})}),a.jsx("td",{align:"center",style:{padding:"10px"},children:a.jsx(k,{required:!0,id:"price",name:"price",type:"number",value:e==null?void 0:e.price,placeholder:"Enter Price",fullWidth:!0,sx:{border:"1px solid white",background:"white",borderRadius:"7px",minWidth:"200px"},onChange:r=>W(r,t),inputProps:{shrink:!0},disabled:!0})}),a.jsxs("td",{align:"center",style:{padding:"10px"},children:[m(b),e==null?void 0:e.amount]}),a.jsxs("td",{align:"center",style:{padding:"10px"},children:[d.length>1&&a.jsx(fe,{onClick:()=>Oe(t),style:{color:"red",cursor:"pointer"}}),d.length==1&&a.jsx(fe,{style:{color:"red",cursor:"pointer"}})]})]})),a.jsxs("tr",{children:[a.jsxs("td",{colSpan:4,align:"right",children:[a.jsx("tr",{children:a.jsxs("td",{children:[a.jsx("tr",{children:a.jsx("td",{align:"left",children:"Discount:"})}),a.jsxs("tr",{children:[a.jsx("td",{children:g?a.jsx(k,{required:!0,id:"discount",name:"discount",type:"number",value:p,onChange:e=>je(e.target.value||0),sx:{border:"1px solid silver",borderRadius:"7px",maxWidth:"90px"},InputProps:{inputProps:{min:0,max:100}}}):a.jsx(k,{required:!0,id:"discount",name:"discount",type:"number",value:p,onChange:e=>je(e.target.value||0),sx:{border:"1px solid silver",borderRadius:"7px",maxWidth:"90px",background:"#e9ecef"},InputProps:{inputProps:{min:0,max:100}},disabled:!0})}),a.jsx("td",{children:a.jsxs(C,{sx:{border:"1px solid silver",width:"200px"},value:g,onChange:e=>Be(e.target.value),children:[a.jsx(h,{value:"fixed",sx:{color:`${l?"white":"black"}`},children:"Fixed"}),a.jsx(h,{value:"percentage",sx:{color:`${l?"white":"black"}`},children:"Percentage"})]})})]})]})}),a.jsx("tr",{children:a.jsxs("td",{children:[a.jsx("tr",{children:a.jsx("td",{align:"left",children:"Tax:"})}),a.jsx("tr",{children:a.jsx("td",{children:a.jsx(C,{labelId:"demo-multiple-checkbox-label",id:"demo-multiple-checkbox",sx:{border:"1px solid silver",borderRadius:"7px",width:"290px"},multiple:!0,value:w,onChange:We,name:"oberAlltax",renderValue:e=>e.join(", "),children:$==null?void 0:$.map((e,t)=>a.jsxs(h,{value:`${e==null?void 0:e.Name}-${e==null?void 0:e.taxvalue}`,sx:{color:`${l?"white":"black"}`},children:[a.jsx(ea,{checked:w.indexOf(`${e==null?void 0:e.Name}-${e==null?void 0:e.taxvalue}`)>-1,sx:{color:`${l?"white":"black"}`}}),a.jsx(aa,{primary:e==null?void 0:e.Name,sx:{color:`${l?"white":"black"}`}})]},t))})})})]})})]}),a.jsx("td",{colSpan:4,align:"right",children:a.jsx("table",{width:"100%",children:a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{align:"right",children:"Sub Total:"}),a.jsxs("td",{align:"right",children:[m(b),parseFloat(A).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{align:"right",children:"Discount:"}),a.jsxs("td",{align:"right",children:[m(b),parseFloat(se).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{align:"right",children:"Tax:"}),a.jsxs("td",{align:"right",children:[m(b),parseFloat(Q).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{align:"right",children:"Total:"}),a.jsxs("td",{align:"right",children:[m(b),parseFloat(K).toFixed(2)]})]})]})})})]})]})]})})})}),a.jsxs(i,{item:!0,xs:12,children:[!T&&a.jsx(a.Fragment,{children:a.jsxs(q,{color:"primary",onClick:()=>B(!T),children:[a.jsx(Ye,{sx:{mr:1}}),"Add Note & Terms"]})}),T&&a.jsx(a.Fragment,{children:a.jsxs(oa,{color:"primary",onClick:()=>B(!T),children:[a.jsx(Je,{sx:{mr:1}}),"Remove Note & Terms"]})})]}),T&&a.jsx(a.Fragment,{children:a.jsx(i,{item:!0,xs:12,sm:12,children:a.jsxs(i,{container:!0,sx:{display:"flex",marginTop:"20px",marginLeft:"20px",flexDirection:"row",gap:"10px"},children:[a.jsxs(i,{item:!0,xs:12,md:12,children:[a.jsx(i,{children:"Note:"}),a.jsx(i,{children:a.jsx(be,{value:G,onChange:Y,modules:pe,style:{color:"black"}})})]}),a.jsxs(i,{item:!0,xs:12,md:12,children:[a.jsx(i,{children:"Terms:"}),a.jsx(i,{children:a.jsx(be,{value:J,onChange:X,modules:pe,style:{color:"black"}})})]})]})})}),a.jsx(i,{item:!0,xs:12,sm:12,children:a.jsxs(i,{sx:{display:"flex",flexDirection:"row",gap:"10px",marginBottom:"20px",justifyContent:"flex-end"},children:[a.jsx(i,{children:a.jsx(q,{onClick:()=>ge("draft"),children:"Save"})}),a.jsx(i,{children:a.jsx(q,{onClick:()=>ge("send"),children:"Save & Send"})}),a.jsx(i,{children:a.jsx(q,{onClick:()=>Ue(),children:"Cancel"})})]})})]})]})})})}export{Aa as default};
