import{k as Ve,u as Be,f as Oe,R as d,r as Q,j as a}from"./index-C7uDDRzi.js";import{j as E,a as w,g as m,p as We,B as ce}from"./App-DlbqwX0_.js";import{R as ue}from"./quill.snow-CnAOdW1t.js";import{d as Qe}from"./Add-zXnTnCgo.js";import{d as xe}from"./Delete-DpahORMc.js";import{d as Ee}from"./Remove-CX5Y-CQr.js";import{u as ze}from"./useCurrency-CKzl8o4T.js";import{C as P}from"./ColorButton-ek59cplY.js";import{T as Le}from"./Toolbar-penBkzvF.js";import{B as z}from"./Box-DuB8RHF0.js";import{T as He}from"./Typography-Bqz4o4Sm.js";import{G as u}from"./Grid-BSdJsjIu.js";import{T as C}from"./TextField-IfJfvW4r.js";import{S as F}from"./Select-DVBf2x5a.js";import{M as h}from"./MenuItem-BEeRBPo2.js";import{C as Ue}from"./Checkbox-CfQURqHz.js";import{L as Me}from"./ListItemText-Dwbi0iPI.js";import{s as Ge}from"./styled-DpNLFuLo.js";import{B as Ye}from"./Button-bVqxygml.js";import"./createSvgIcon-D3EdHNeB.js";import"./createSvgIcon-CvjaZCwn.js";import"./TransitionGroupContext-BuEQjJx-.js";import"./isMuiElement-MrDrvzNs.js";import"./ButtonBase-Cb7r6f8i.js";import"./FormControl-Bz1rNlOw.js";import"./Menu-DLoDL8Vj.js";import"./Backdrop-92jRYuW8.js";import"./utils-D1Bwf65I.js";import"./dividerClasses-Bc8akPt1.js";import"./listItemTextClasses-BL6EH0EV.js";import"./SwitchBase-F3oRA7lj.js";const Ke=Ge(Ye)(({theme:j})=>({color:j.palette.getContrastText(We[500]),backgroundColor:"red","&:hover":{backgroundColor:"red"}}));function Da(){const j=Ve(),N=Be(),{currencyList:_}=ze(),[p]=Oe(),[L,y]=d.useState(0),[H,he]=d.useState(""),[pe,ge]=d.useState(""),[U,M]=d.useState("");d.useState("yes");const[k,je]=d.useState([]),[G,f]=d.useState(0),[Y,K]=d.useState(""),[Je,fe]=d.useState(""),[A,D]=d.useState(0),[Xe,ve]=d.useState([]),[v,J]=d.useState(""),[be,ye]=d.useState("unpaid"),[g,X]=d.useState(""),[Z,ee]=d.useState(""),[ae,T]=d.useState(0),[S,te]=d.useState([]),[re,oe]=d.useState(""),[x,R]=d.useState(0),[$,V]=d.useState(!1),[se,ne]=d.useState("Default"),[I,le]=d.useState(0),[me,Ce]=d.useState(""),[l,b]=Q.useState([{productName:"",productId:"",qty:"",price:"",tax:0,taxValue:0,amount:0}]),q="api";Q.useEffect(()=>{var t,r;const e=E(localStorage.getItem("token"));Te((t=e==null?void 0:e.data)==null?void 0:t.id),Se((r=e==null?void 0:e.data)==null?void 0:r.id),ke(),Re()},[]);const de={toolbar:[[{header:"1"},{header:"2"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},B=(e,t)=>{t=="error"?ce.error(e,{position:"top-center",autoClose:1900,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}):ce.success(e,{position:"top-center",autoClose:1900,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"})},ke=async()=>{await w.get(`/${q}/v1/quote/${j==null?void 0:j.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>{var t,r,s,n,o,c;e.data.status=="201"&&(he(e.data.data[0].quote_number),fe((r=(t=e==null?void 0:e.data)==null?void 0:t.data[0])==null?void 0:r.url),ge((n=(s=e==null?void 0:e.data)==null?void 0:s.data[0])==null?void 0:n.userid),Ce((c=(o=e==null?void 0:e.data)==null?void 0:o.data[0])==null?void 0:c.othersInfo),ee(e.data.data[0].invoice_date),oe(e.data.data[0].due_date),ye(e.data.data[0].status),ne(e.data.data[0].invoice_country),J(e.data.data[0].currency),D(e.data.data[0].subTotal),T(e.data.data[0].sub_discount),y(e.data.data[0].sub_tax),f(e.data.data[0].total),b(e.data.data[0].productsInfo),X(e.data.data[0].discount_type),R(e.data.data[0].discount),te(e.data.data[0].tax),M(e.data.data[0].note),K(e.data.data[0].terms),(e.data.data[0].note||e.data.data[0].terms)&&V(!0))}).catch(e=>{console.log("error",e)})},Te=async e=>{await w.get(`/${q}/v1/tax/list/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(t=>{t.data.status=="201"&&je(t.data.data)}).catch(t=>{console.log("error",t)})},Se=async e=>{await w.get(`/${q}/v1/qrcode/list/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(t=>{t.data.status=="201"&&ve(t.data.data)}).catch(t=>{console.log("error",t)})},$e=()=>{b([...l,{productName:"",productId:"",qty:"",price:"",tax:0,taxValue:0,amount:0}])};Q.useEffect(()=>{Ie()},[l,g,x,S]);const Ie=()=>{var e=0,t=0;if(l==null||l.map(i=>{i.qty!=""&&i.price!=""&&(e=e+parseFloat(i.qty)*parseFloat(i.price)),i.tax>0&&(t=t+i.taxValue)}),t>0){var r=e+t;y(t),f(r),D(e)}else y(t),f(e),D(e);if(g!=""){if(g=="fixed"){var s=e*t/100;if(I>0)var r=e+I-x;else var r=e+s-x;y(s),f(r),D(e),T(x)}else if(g=="percentage"){var s=e*t/100;if(I>0){var r=e+I-(e+I)*(x/100);T((e+I)*x/100)}else{var r=e+s-(e+s)*x/100;T((e+s)*x/100)}y(s),f(r),D(e)}}var n=0;if(S.length>0&&(k==null||k.map(i=>{S.includes(`${i.Name}-${i.taxvalue}`)&&(n=n+i.taxvalue)})),n>0){var r=e+t,o=r*n/100,c=r+o;le(t+o),y(t+o),f(c),g!=""&&(console.log("newTotal",c,g,x),g=="fixed"&&x>0?(f(c-parseFloat(x)),T(x)):g=="percentage"&&(f(c-c*parseFloat(x)/100),T(c*parseFloat(x)/100)))}else le(t),y(t)};async function qe(e){const t=e.split("-");return await w.get(`/${q}/v1/product/${t[0]}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(s=>{var n,o,c,i;if(s.data.status==201)return console.log("Price",(o=(n=s==null?void 0:s.data)==null?void 0:n.data)==null?void 0:o.unitPrice),(i=(c=s==null?void 0:s.data)==null?void 0:c.data)==null?void 0:i.unitPrice}).catch(s=>{console.log("Invoice Product API Error",s)})}const O=async(e,t)=>{let{name:r,value:s}=e.target;if(r=="qty"){let n=[...l];n[t].qty=s,b(n),l==null||l.map((o,c)=>{c==t&&o.qty!=""&&o.price!=""&&(n[t].amount=parseFloat(o.qty)*parseFloat(o.price),n[t].taxValue=(o==null?void 0:o.amount)*o.tax/100)})}else if(r=="price"){let n=[...l];n[t].price=s,b(n),l==null||l.map((o,c)=>{c==t&&o.qty!=""&&o.price!=""&&(n[t].amount=parseFloat(o.qty)*parseFloat(o.price),n[t].taxValue=(o==null?void 0:o.amount)*o.tax/100)})}else if(r=="productName"){const n=await qe(s);let o=[...l];const c=s.split("-");o[t].productName=c[1],o[t].productId=c[0],o[t].price=n,o[t].qty="1",l==null||l.map((i,Ae)=>{Ae==t&&i.qty!=""&&i.price!=""&&(o[t].amount=parseFloat(i.qty)*parseFloat(i.price),o[t].taxValue=(i==null?void 0:i.amount)*i.tax/100)}),b(o)}else if(r=="amount"){let n=[...l];n[t].amount=s,b(n)}else if(r=="tax"){let n=[...l];console.log("taxvalue",s),n[t].tax=s,b(n),l==null||l.map((o,c)=>{c==t&&o.qty!=""&&o.price!=""&&(n[t].taxValue=(o==null?void 0:o.amount)*o.tax/100)})}},we=e=>{X(e),R(0)},De=e=>{const t=[...l];t.splice(e,1),b(t)},Pe=e=>{const{target:{value:t}}=e;te(typeof t=="string"?t.split(","):t)},[W,Fe]=d.useState([]),Re=async()=>{var t;const e=E(localStorage.getItem("token"));await w.get(`/${q}/v1/product/list/${(t=e==null?void 0:e.data)==null?void 0:t.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(r=>{var s;r.data.status=="201"&&Fe((s=r==null?void 0:r.data)==null?void 0:s.data)}).catch(r=>{console.log("error",r)})},Ne=async()=>{var t;const e=E(localStorage.getItem("token"));await w.patch(`/${q}/v1/quote/update/${j==null?void 0:j.id}`,{user:(t=e==null?void 0:e.data)==null?void 0:t.id,userid:pe,othersInfo:me,quote_number:H,invoice_country:se,invoice_date:Z,due_date:re,currency:v,productsInfo:l,discount:x,discount_type:g,tax:S,subTotal:A,sub_discount:ae,sub_tax:L,total:G,status:be,note:U,terms:Y,noteandterms:$,currency_text:m(v)},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(r=>{r.data.status=="201"&&(B(r.data.message,"success"),N("/invoice-section"))}).catch(r=>{console.log("error",r),B(r.response.data.message,"error")})},_e=()=>{var e=confirm("Are you sure?");if(e==!0)N("/invoices/quotes/list");else return!1},ie=e=>{e>A?(B("Discount should be less than or equal to subtotal amount","error"),R(0)):R(e)};return a.jsx(a.Fragment,{children:a.jsx(Le,{sx:{display:"flex",flexDirection:"column",padding:"12px",borderRadius:".5rem",p:"2px",marginTop:"10px",background:{xs:`${p?"#183153":""}`,md:`${p?"#183153":"white"}`},border:{xs:`${p?"1px solid white":""}`,md:`${p?"1px solid white":"white"}`}},children:a.jsxs(z,{sx:{marginTop:"0%",borderRadius:".5rem"},children:[a.jsx(He,{children:a.jsx(P,{sx:{cursor:"pointer",float:"right",marginTop:"10px"},onClick:()=>N("/invoices/quotes/list"),children:"Back"})}),a.jsxs(u,{container:!0,spacing:3,children:[a.jsxs(u,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Quote #"}),a.jsx(C,{required:!0,id:"quote",name:"quote",value:H,fullWidth:!0,sx:{border:"1px solid silver",borderRadius:"7px"},inputProps:{shrink:!0}})]}),a.jsxs(u,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Quote Date"}),a.jsx(C,{required:!0,id:"value",name:"value",type:"date",value:Z,fullWidth:!0,onChange:e=>ee(e.target.value),sx:{border:"1px solid silver",borderRadius:"7px"},inputProps:{shrink:!0}})]}),a.jsxs(u,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Due Date"}),a.jsx(C,{required:!0,id:"value",name:"value",type:"date",fullWidth:!0,value:re,onChange:e=>oe(e.target.value),sx:{border:"1px solid silver",borderRadius:"7px"},inputProps:{shrink:!0}})]}),a.jsxs(u,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Invoice Template"}),a.jsxs(F,{fullWidth:!0,value:se,name:"status",sx:{border:"1px solid silver",borderRadius:"7px"},onChange:e=>ne(e.target.value),children:[a.jsx(h,{value:"Default",children:"Default"}),a.jsx(h,{value:"New_York",children:"New York"}),a.jsx(h,{value:"Toronto",children:"Toronto"}),a.jsx(h,{value:"Rio",children:"Rio"}),a.jsx(h,{value:"London",children:"London"}),a.jsx(h,{value:"Istanbul",children:"Istanbul"}),a.jsx(h,{value:"Mumbai",children:"Mumbai"}),a.jsx(h,{value:"Hong_Kong",children:"Hong Kong"}),a.jsx(h,{value:"Tokyo",children:"Tokyo"}),a.jsx(h,{value:"Paris",children:"Paris"})]})]}),a.jsxs(u,{item:!0,xs:12,sm:6,children:[a.jsx("label",{children:"Select Currency:"}),a.jsx(F,{fullWidth:!0,value:v,name:"currency",onChange:e=>J(e.target.value),sx:{border:"1px solid silver",borderRadius:"7px"},children:_==null?void 0:_.map((e,t)=>a.jsxs(h,{value:e==null?void 0:e.base_code,children:[m(e==null?void 0:e.base_code)," ",e==null?void 0:e.base_code]},t))})]}),a.jsx(u,{item:!0,xs:12,sm:12,sx:{display:"flex",flexDirection:"row",justifyContent:"end"},children:a.jsx(P,{onClick:()=>$e(),children:"Add"})}),a.jsx(z,{sx:{overflow:"auto"},children:a.jsx(z,{sx:{width:"100%",display:"table",tableLayout:"fixed"},children:a.jsx(u,{item:!0,xs:12,sm:12,children:a.jsxs("table",{width:"100%",style:{borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{background:"#c0c0c01f"},children:[a.jsx("th",{style:{padding:"10px"},children:"#"}),a.jsx("th",{style:{padding:"10px"},children:"PRODUCT"}),a.jsx("th",{style:{padding:"10px"},children:"QTY"}),a.jsx("th",{style:{padding:"10px"},children:"UNIT PRICE"}),a.jsx("th",{style:{padding:"10px"},children:"AMOUNT"}),a.jsx("th",{style:{minWidth:"100px"},children:"ACTION"})]})}),a.jsxs("tbody",{children:[l.map((e,t)=>a.jsxs("tr",{children:[a.jsx("td",{align:"center",style:{padding:"10px"},children:t+1}),a.jsx("td",{align:"center",style:{padding:"10px"},children:a.jsx(F,{id:"productName",value:`${e==null?void 0:e.productId}-${e==null?void 0:e.productName}`,name:"productName",onChange:r=>O(r,t),sx:{border:`${p?"1px solid silver":"black"}`,minWidth:"120px"},fullWidth:!0,required:!0,children:W==null?void 0:W.map((r,s)=>a.jsx(h,{value:`${r==null?void 0:r._id}-${r==null?void 0:r.name}`,sx:{color:`${p?"white":"black"}`},children:r==null?void 0:r.name},s))})}),a.jsx("td",{align:"center",style:{padding:"10px"},children:a.jsx(C,{required:!0,id:"qty",name:"qty",type:"number",value:e==null?void 0:e.qty,placeholder:"Enter Quantity",fullWidth:!0,sx:{border:"1px solid white",color:"white",borderRadius:"7px",minWidth:"200px"},onChange:r=>O(r,t),inputProps:{shrink:!0}})}),a.jsx("td",{align:"center",style:{padding:"10px"},children:a.jsx(C,{required:!0,id:"price",name:"price",type:"number",value:e==null?void 0:e.price,placeholder:"Enter Price",fullWidth:!0,sx:{border:"1px solid white",background:"white",borderRadius:"7px",minWidth:"200px"},onChange:r=>O(r,t),inputProps:{shrink:!0},disabled:!0})}),a.jsxs("td",{align:"center",style:{padding:"10px"},children:[m(v),e==null?void 0:e.amount]}),a.jsxs("td",{align:"center",style:{padding:"10px"},children:[l.length>1&&a.jsx(xe,{onClick:()=>De(t),style:{color:"red",cursor:"pointer"}}),l.length==1&&a.jsx(xe,{style:{color:"red",cursor:"pointer"}})]})]})),a.jsxs("tr",{children:[a.jsxs("td",{colSpan:4,align:"right",children:[a.jsx("tr",{children:a.jsxs("td",{children:[a.jsx("tr",{children:a.jsx("td",{align:"left",children:"Discount:"})}),a.jsxs("tr",{children:[a.jsx("td",{children:g?a.jsx(C,{required:!0,id:"discount",name:"discount",type:"number",value:x,onChange:e=>ie(e.target.value||0),sx:{border:"1px solid silver",borderRadius:"7px",maxWidth:"90px"},InputProps:{inputProps:{min:0,max:100}}}):a.jsx(C,{required:!0,id:"discount",name:"discount",type:"number",value:x,onChange:e=>ie(e.target.value||0),sx:{border:"1px solid silver",borderRadius:"7px",maxWidth:"90px",background:"#e9ecef"},InputProps:{inputProps:{min:0,max:100}},disabled:!0})}),a.jsx("td",{children:a.jsxs(F,{sx:{border:"1px solid silver",width:"200px",color:`${p?"white":"black"}`},value:g,onChange:e=>we(e.target.value),children:[a.jsx(h,{value:"fixed",sx:{color:`${p?"white":"black"}`},children:"Fixed"}),a.jsx(h,{value:"percentage",sx:{color:`${p?"white":"black"}`},children:"Percentage"})]})})]})]})}),a.jsx("tr",{children:a.jsxs("td",{children:[a.jsx("tr",{children:a.jsx("td",{align:"left",children:"Tax:"})}),a.jsx("tr",{children:a.jsx("td",{children:a.jsx(F,{labelId:"demo-multiple-checkbox-label",id:"demo-multiple-checkbox",sx:{border:"1px solid silver",marginTop:"5px",borderRadius:"7px",width:"290px"},multiple:!0,value:S,onChange:Pe,name:"oberAlltax",renderValue:e=>e.join(", "),children:k==null?void 0:k.map((e,t)=>a.jsxs(h,{value:`${e==null?void 0:e.Name}-${e==null?void 0:e.taxvalue}`,children:[a.jsx(Ue,{checked:S.indexOf(`${e==null?void 0:e.Name}-${e==null?void 0:e.taxvalue}`)>-1,sx:{color:`${p?"white":"black"}`}}),a.jsx(Me,{primary:e==null?void 0:e.Name,sx:{color:`${p?"white":"black"}`}})]},t))})})})]})})]}),a.jsx("td",{colSpan:4,align:"right",children:a.jsx("table",{width:"100%",children:a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{align:"right",children:"Sub Total:"}),a.jsxs("td",{align:"right",children:[m(v),parseFloat(A).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{align:"right",children:"Discount:"}),a.jsxs("td",{align:"right",children:[m(v),parseFloat(ae).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{align:"right",children:"Tax:"}),a.jsxs("td",{align:"right",children:[m(v),parseFloat(L).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{align:"right",children:"Total:"}),a.jsxs("td",{align:"right",children:[m(v),parseFloat(G).toFixed(2)]})]})]})})})]})]})]})})})}),a.jsxs(u,{item:!0,xs:12,children:[!$&&a.jsx(a.Fragment,{children:a.jsxs(P,{color:"primary",onClick:()=>V(!$),children:[a.jsx(Qe,{sx:{mr:1}}),"Add Note & Terms"]})}),$&&a.jsx(a.Fragment,{children:a.jsxs(Ke,{color:"primary",onClick:()=>V(!$),children:[a.jsx(Ee,{sx:{mr:1}}),"Remove Note & Terms"]})})]}),$&&a.jsx(a.Fragment,{children:a.jsx(u,{item:!0,xs:12,sm:12,children:a.jsxs(u,{container:!0,sx:{display:"flex",marginTop:"20px",marginLeft:"20px",flexDirection:"row",gap:"10px"},children:[a.jsxs(u,{item:!0,xs:10,sm:12,children:[a.jsx(u,{children:"Note:"}),a.jsx(u,{children:a.jsx(ue,{value:U,onChange:M,className:`${p?"ql-strokelight":"ql-strokedark"}`,modules:de,style:{color:`${p?"white":"black"}`}})})]}),a.jsxs(u,{item:!0,xs:10,sm:12,children:[a.jsx(u,{children:"Terms:"}),a.jsx(u,{children:a.jsx(ue,{value:Y,onChange:K,modules:de,style:{color:"black"}})})]})]})})}),a.jsx(u,{item:!0,xs:12,sm:12,children:a.jsxs(u,{sx:{display:"flex",flexDirection:"row",gap:"10px",marginBottom:"20px",justifyContent:"flex-end"},children:[a.jsx(u,{children:a.jsx(P,{onClick:()=>Ne(),children:"Save & Send"})}),a.jsx(u,{children:a.jsx(P,{onClick:()=>_e(),children:"Cancel"})})]})})]})]})})})}export{Da as default};
